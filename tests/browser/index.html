<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title></title>

	<style type="text/css">
		textarea {
			width: 30em;
			height: 20em;
		}
	</style>
</head>
<body>
<textarea>
:root {
	--black: #282933;
	--color: #505166;
	--font-sans: 'Open Sans', Helvetica, sans-serif;
	--font-serif: 'Lora', Georgia, sans-serif;
}

body {
	color: var(--black);
	font-family: var(--font-serif);
	position: relative;
}
</textarea>
	<script type="text/javascript" src="b.js"></script>
	<script type="text/javascript">
		var stylecow = require('./browser');

		stylecow.addTask({
			//Use var() function
			"Function": {
				var: function (fn) {
					var arguments = fn.getContent();
					var value = fn.ancestor('Rule').getData(arguments[0]) || arguments[1];

					if (value) {
						fn.replaceWith(value);
					}

				}
			},

			//Save new --variables
			Declaration: function (declaration) {
				if (declaration.name.indexOf('--') === 0) {
					var rule = declaration.ancestor('Rule');

					if (rule.hasChild('Selector', [':root', 'html'])) {
						rule.ancestor('Root').setData(declaration.name, declaration.value);
					} else {
						rule.setData(declaration.name, declaration.value);
					}

					declaration.remove();
				}
			}
		});

		var textarea = document.querySelector('textarea');
		
		textarea.onblur = function () {
			var result = stylecow.convert(this.value);
			console.log(result);
			console.log(result.toString());
		}
	</script>
</body>
</html>